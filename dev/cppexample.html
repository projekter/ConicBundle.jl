<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example for the C++ interface · ConicBundle.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">ConicBundle.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><a class="tocitem" href="cexample.html">Example for the C interface</a></li><li class="is-active"><a class="tocitem" href="cppexample.html">Example for the C++ interface</a></li><li><a class="tocitem" href="cppref.html">Reference of C++ interface</a></li><li><a class="tocitem" href="cref.html">Reference of C interface</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="cppexample.html">Example for the C++ interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="cppexample.html">Example for the C++ interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/projekter/ConicBundle.jl/blob/main/docs/src/cppexample.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-for-the-C-interface"><a class="docs-heading-anchor" href="#Example-for-the-C-interface">Example for the C++ interface</a><a id="Example-for-the-C-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Example-for-the-C-interface" title="Permalink"></a></h1><p>Here, we outline the <a href="https://www-user.tu-chemnitz.de/~helmberg/ConicBundle/Manual/mctutorial.html">MAXCUT example</a>, although we don&#39;t implement all the custom triangle functionality (though it would certainly be possible).</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using ConicBundle</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; import MutableArithmetics as MA</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: ArgumentError: Package MutableArithmetics not found in current path.
- Run `import Pkg; Pkg.add(&quot;MutableArithmetics&quot;)` to install the MutableArithmetics package.</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # warning: we have to take care of garbage collection by ourselves!
       garbage = [];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_gc(x) = (push!(garbage, x); x);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; STDIN = open(&quot;samplegraph.dat&quot;, &quot;r&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">IOStream(&lt;file samplegraph.dat&gt;)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # read the graph into (indi,indj,val) triples (replace val by 1.)
       nnodes = parse(Int, readuntil(STDIN, &quot; &quot;))</code><code class="nohighlight hljs ansi" style="display:block;">50</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; medges = parse(Int, readuntil(STDIN, &quot;\n&quot;))</code><code class="nohighlight hljs ansi" style="display:block;">800</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; indi = add_gc(CBIndexmatrix(medges, 1, 0))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBIndexmatrix(Ptr{Nothing} @0x0000000002c382c0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; indj = add_gc(CBIndexmatrix(medges, 1, 0))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBIndexmatrix(Ptr{Nothing} @0x00000000028953b0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; val = add_gc(CBMatrix(medges, 1, 1.))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x0000000002798410)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; for i in 0:medges-1
           head = parse(Int, readuntil(STDIN, &quot; &quot;))
           tail = parse(Int, readuntil(STDIN, &quot; &quot;))
           d = parse(Float64, readuntil(STDIN, &quot;\n&quot;))
           indi[i] = tail -1
           indj[i] = head -1
           # val[i] = d # edge weight d could be plugged in here
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; close(STDIN)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; L = add_gc(CBSparsesym(nnodes, medges, indi, indj, val))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBSparsesym(Ptr{Nothing} @0x0000000002911d20)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; Ldiag = add_gc(CBMatrix(cb_diag(L)))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x00000000024c6630)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; L = MA.operate!(-, L, add_gc(cb_sparseDiag(Ldiag, 1e-60)))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `MA` not defined</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_init!(Ldiag, nnodes, 1, cb_sum(L) / nnodes)</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x00000000024c6630)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; L = MA.operate!(*, L, -1)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `MA` not defined</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; L = MA.operate!(+, L, add_gc(cb_sparseDiag(Ldiag, 1e-60)))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `MA` not defined</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; L = MA.operate!(/, L, 4.)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `MA` not defined</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; bestcut = add_gc(CBMatrix(nnodes, 1, 1.))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x0000000002b78190)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; bestcut_val = cb_ip(bestcut, L * bestcut)</code><code class="nohighlight hljs ansi" style="display:block;">1570.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # form the Affine Matrix Function Oracle
       Xdim = add_gc(CBIndexmatrix(1, 1, nnodes))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBIndexmatrix(Ptr{Nothing} @0x0000000002660700)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; C = add_gc(CBSparseCoeffmatMatrix(Xdim, 1))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBSparseCoeffmatMatrix(Ptr{Nothing} @0x0000000002a44330)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_set!(C, 0, 0, CBCMsymsparse(L)) # by default, ownership is managed by the coeffmat</code><code class="nohighlight hljs ansi" style="display:block;">0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; opAt = add_gc(CBSparseCoeffmatMatrix(Xdim, nnodes))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBSparseCoeffmatMatrix(Ptr{Nothing} @0x0000000002b5dfd0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; for i in 0:nnodes-1
           cb_set!(opAt, 0, i, CBCMsingleton(nnodes, i, i, -1.)) # by default, the singletons are deleted by the coeffmat
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; mc = add_gc(CBPSCAffineFunction(C, opAt, CBGramSparsePSCPrimal(L))) # ownership of third argument passes to the function</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBPSCAffineFunction(Ptr{Nothing} @0x0000000001a42460)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_set_out!(mc, 0)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # initialize the solver and the problem
       cbsolver = add_gc(CBMatrixCBSolver(1))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrixCBSolver(Ptr{Nothing} @0x000000000282bd90)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; lb = add_gc(CBMatrix(nnodes, 1, cb_minus_infinity))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x0000000002ff6810)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ub = add_gc(CBMatrix(nnodes, 1, cb_plus_infinity))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x0000000003a99e50)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; rhs = add_gc(CBMatrix(nnodes, 1, 1.))</code><code class="nohighlight hljs ansi" style="display:block;">ConicBundle.CBMatrix(Ptr{Nothing} @0x0000000003aa9f50)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_init_problem!(cbsolver, nnodes, lb, ub, nothing, rhs)</code><code class="nohighlight hljs ansi" style="display:block;">0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_add_function!(cbsolver, mc, nnodes, cbft_objective_function, nothing, true)</code><code class="nohighlight hljs ansi" style="display:block;">0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # call the solver
       cb_set_active_bounds_fixing!(cbsolver, true)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_solve!(cbsolver) # here we could do all the rounding from the example</code><code class="nohighlight hljs ansi" style="display:block;">00:00:00.02 enditd   1    1    1   1.82    1.35  1617.500435  1617.548145
00:00:00.02 enditd   2    2    2   1.82    1.28  1615.846748  1615.884978
00:00:00.02 enditd   3    3    3  0.182    4.03  1599.541868  1601.547786
00:00:00.02 enditd   4    4    4 0.0446    5.18  1571.320440  1573.619568
00:00:00.02 enditd   5    8    8 0.00679   0.505  1569.958640  1570.076306
00:00:00.03 enditd   6   10   10 0.00679   0.117  1569.997260  1570.012813
00:00:00.03 endit_   6   12   12 0.00679  0.0483  1569.999151  1570.012813
0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_print_termination_code(cbsolver)</code><code class="nohighlight hljs ansi" style="display:block;">termination status: 1, relative precision criterion satisfied</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cb_destroy!(@view(garbage[end:-1:1])...)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="cexample.html">« Example for the C interface</a><a class="docs-footer-nextpage" href="cppref.html">Reference of C++ interface »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 3 July 2023 13:45">Monday 3 July 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
